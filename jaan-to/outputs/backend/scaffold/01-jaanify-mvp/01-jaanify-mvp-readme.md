# Jaanify API — Setup & Run Guide

> Generated by jaan.to backend-scaffold | 2026-02-09

## Prerequisites

- Node.js v22+ LTS
- pnpm v9+
- PostgreSQL 16 (or Supabase account)
- Redis 7 (optional, for caching/queues)

## Quick Start

```bash
# 1. Install dependencies
pnpm install

# 2. Copy environment variables
cp .env.example .env
# Edit .env with your database URL, Google OAuth credentials, JWT secrets

# 3. Generate Prisma client
pnpm db:generate

# 4. Run database migrations
pnpm db:migrate:dev

# 5. Start development server
pnpm dev
```

The API will be available at `http://localhost:3000/v1` with Swagger docs at `http://localhost:3000/docs`.

## Project Structure

```
src/
├── app.ts                    # Fastify app factory (plugins + routes)
├── server.ts                 # Entry point (env validation + listen + shutdown)
├── lib/
│   ├── env.ts                # Zod environment variable validation
│   ├── prisma.ts             # PrismaClient singleton (globalThis pattern)
│   └── errors.ts             # RFC 9457 error helpers
├── plugins/
│   └── middleware.ts          # Auth (JWT) + Error handler (RFC 9457)
├── routes/
│   ├── auth/index.ts          # POST google, refresh, register; DELETE logout
│   ├── users/index.ts         # GET/PATCH/DELETE /users/me
│   ├── tasks/index.ts         # Full CRUD + parse endpoint
│   ├── daily-plans/index.ts   # List, generate, get, update slot
│   ├── feedback/index.ts      # POST /feedback
│   └── guest-sessions/index.ts # POST + GET by anonymous_id
└── prisma/
    └── schema.prisma          # 7 models matching data model spec
```

## Available Scripts

| Script | Description |
|--------|-------------|
| `pnpm dev` | Start dev server with hot reload (tsx watch) |
| `pnpm build` | Compile TypeScript to JavaScript |
| `pnpm start` | Start production server |
| `pnpm test` | Run tests (Vitest) |
| `pnpm lint` | Run ESLint |
| `pnpm db:generate` | Generate Prisma client |
| `pnpm db:migrate:dev` | Create + apply migrations (dev) |
| `pnpm db:migrate:deploy` | Apply migrations (production) |
| `pnpm db:push` | Push schema to DB (prototyping) |
| `pnpm db:seed` | Seed database |
| `pnpm db:studio` | Open Prisma Studio |

## API Endpoints (21 total)

| Method | Path | Auth | Description |
|--------|------|------|-------------|
| POST | `/v1/auth/google` | No | Google OAuth2 login |
| POST | `/v1/auth/refresh` | No | Refresh access token |
| POST | `/v1/auth/register` | No | Convert guest → account |
| DELETE | `/v1/auth/logout` | Yes | Invalidate tokens |
| GET | `/v1/users/me` | Yes | Current user profile |
| PATCH | `/v1/users/me` | Yes | Update profile |
| DELETE | `/v1/users/me` | Yes | Delete account |
| GET | `/v1/tasks` | Yes | List tasks (paginated) |
| POST | `/v1/tasks` | Yes | Create task |
| POST | `/v1/tasks/parse` | Yes | AI parse preview |
| GET | `/v1/tasks/:id` | Yes | Get task |
| PATCH | `/v1/tasks/:id` | Yes | Update task |
| DELETE | `/v1/tasks/:id` | Yes | Delete task |
| GET | `/v1/daily-plans` | Yes | List plans |
| POST | `/v1/daily-plans/generate` | Yes | Generate AI plan |
| GET | `/v1/daily-plans/:id` | Yes | Get plan + slots |
| PATCH | `/v1/daily-plans/:id/slots/:sid` | Yes | Update slot |
| POST | `/v1/feedback` | Yes | Submit feedback |
| POST | `/v1/guest-sessions` | No | Create guest session |
| GET | `/v1/guest-sessions/:anon_id` | No | Get guest session |
| GET | `/v1/health` | No | Health check |

## Environment Variables

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `DATABASE_URL` | Yes | — | PostgreSQL connection string |
| `PORT` | No | 3000 | Server port |
| `HOST` | No | 0.0.0.0 | Server host |
| `NODE_ENV` | No | development | Environment |
| `LOG_LEVEL` | No | info | Pino log level |
| `CORS_ORIGIN` | No | http://localhost:3001 | Allowed CORS origin |
| `GOOGLE_CLIENT_ID` | Yes | — | Google OAuth client ID |
| `GOOGLE_CLIENT_SECRET` | Yes | — | Google OAuth client secret |
| `JWT_SECRET` | Yes | — | JWT signing secret (min 32 chars) |
| `REFRESH_TOKEN_SECRET` | Yes | — | Refresh token secret (min 32 chars) |
| `OPENAI_API_KEY` | Yes | — | OpenAI API key for AI parsing |
| `REDIS_URL` | No | — | Redis connection string |

## Error Handling (RFC 9457)

All errors return `Content-Type: application/problem+json`:

```json
{
  "type": "https://api.jaanify.com/errors/validation",
  "status": 400,
  "title": "Validation Error",
  "detail": "2 validation error(s) in request",
  "instance": "/v1/tasks",
  "errors": [
    { "detail": "Required", "pointer": "/title" }
  ]
}
```

## TODO Items (Implementation Required)

- [ ] JWT signing/verification (replace `decodeJwt` stub with `@fastify/jwt` or `jsonwebtoken`)
- [ ] Google OAuth2 token exchange (call `googleapis.com/oauth2/v4/token`)
- [ ] OpenAI integration for task parsing (structured output with `gpt-4o-mini`)
- [ ] AI daily plan optimization (replace priority-sort stub with LLM-powered ordering)
- [ ] Redis caching for hot queries (task lists, daily plans)
- [ ] BullMQ queue for async AI operations
- [ ] Rate limiting (`@fastify/rate-limit`)
- [ ] Socket.io integration for real-time task updates
