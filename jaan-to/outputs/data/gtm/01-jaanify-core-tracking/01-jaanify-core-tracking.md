# Jaanify Core Tracking — GTM dataLayer Specification

> Generated by jaan.to | 2026-02-07

---

## Executive Summary

Production-ready GTM dataLayer tracking code for Jaanify MVP covering 4 flow categories with 18 tracking events. Includes task creation (text + voice), AI daily planner with reasoning card engagement, 60-second onboarding funnel, and core engagement metrics. All events align with PRD success metrics (time-to-first-task, reasoning card engagement rate, voice task creation rate, Day 7/30 retention cohorts). Uses `al_tracker_custom` for user actions and `al_tracker_impression` for visibility events.

---

## Metadata

| Field | Value |
|-------|-------|
| Feature Scope | Task Creation, AI Planner, Onboarding, Core Engagement |
| Event Count | 18 events (14 click-datalayer, 4 impression) |
| Naming Convention | lowercase-kebab-case |
| Event Format | `al_tracker_custom` / `al_tracker_impression` |
| KPI Alignment | PRD Success Metrics (7 KPIs) |
| Generated | 2026-02-07 |

---

## KPI-to-Event Mapping

| PRD Success Metric | Target | Tracking Events |
|-------------------|--------|-----------------|
| Time-to-First-Task | <60s | `session-started` → `task-created` (timestamp delta) |
| Day 7 Retention | >40% | `session-started` (PostHog cohort) |
| Task Completion Rate | >70% | `task-completed` / `task-created` per user/week |
| Reasoning Card Engagement | >30% expand | `reasoning-card-expanded` / `reasoning-card-shown` |
| Voice Task Creation Rate | >15% | `task-created` where method="voice" / total |
| Day 30 Retention | >15% | `session-started` (PostHog cohort) |
| WAU | 1,000 (Mo 3) | `session-started` unique weekly |

---

## Flow 1: Task Creation

### Event: task-created

Fires when a task is saved (either via text or voice input).

```javascript
// Task created — fires on save
dataLayer.push({
  event: "al_tracker_custom",
  al: {
    feature: "task-creation",
    item: "task-created",
    action: "save",
    params: {
      method: "text",           // "text" | "voice"
      has_deadline: true,       // bool: AI extracted deadline
      has_category: true,       // bool: AI extracted category
      has_subtasks: false,      // bool: AI extracted subtasks
      priority: "high",         // "high" | "medium" | "low" | "none"
      fields_edited: 1,         // int: number of parsed fields user edited before save
      parse_time_ms: 850,       // int: milliseconds for AI parse to complete
      is_first_task: true,      // bool: user's first task ever (for time-to-first-task KPI)
    }
  },
  _clear: true
});
```

### Event: ai-parse-completed

Fires when the AI finishes parsing the user's natural language input.

```javascript
// AI parsing completed — fires after 600ms debounce + API response
dataLayer.push({
  event: "al_tracker_custom",
  al: {
    feature: "task-creation",
    item: "ai-parse-completed",
    action: "parse",
    params: {
      input_length: 45,         // int: character count of user input
      fields_extracted: 3,      // int: number of fields AI extracted (0-5)
      parse_time_ms: 850,       // int: total parse duration
      method: "text",           // "text" | "voice"
    }
  },
  _clear: true
});
```

### Event: parsed-field-edited

Fires when the user edits a field the AI parsed.

```javascript
// User edits an AI-parsed field before saving
dataLayer.push({
  event: "al_tracker_custom",
  al: {
    feature: "task-creation",
    item: "parsed-field-edited",
    action: "edit",
    params: {
      field_name: "deadline",   // "deadline" | "category" | "priority" | "subtasks" | "title"
    }
  },
  _clear: true
});
```

### Event: voice-capture-started

Fires when user taps the mic button to start voice input.

```javascript
// Voice capture initiated
dataLayer.push({
  event: "al_tracker_custom",
  al: {
    feature: "task-creation",
    item: "voice-capture-started",
    action: "start",
    params: {
      source: "fab",            // "fab" | "input-page" (where the mic was tapped)
    }
  },
  _clear: true
});
```

### Event: voice-capture-completed

Fires when voice transcription finishes (success or failure).

```javascript
// Voice capture completed
dataLayer.push({
  event: "al_tracker_custom",
  al: {
    feature: "task-creation",
    item: "voice-capture-completed",
    action: "complete",
    params: {
      success: true,            // bool: transcription succeeded
      duration_ms: 4200,        // int: recording duration in ms
      word_count: 12,           // int: words in transcription
    }
  },
  _clear: true
});
```

---

## Flow 2: AI Daily Planner

### Event: daily-plan-generated

Fires when the AI generates or regenerates the daily plan.

```javascript
// Daily plan generated
dataLayer.push({
  event: "al_tracker_custom",
  al: {
    feature: "daily-planner",
    item: "daily-plan-generated",
    action: "generate",
    params: {
      task_count: 5,            // int: number of tasks in plan
      generation_time_ms: 2100, // int: AI generation time
      trigger: "auto",          // "auto" | "manual" | "override"
    }
  },
  _clear: true
});
```

### Event: reasoning-card-shown (Impression)

Fires when a Tier 1 reasoning card becomes visible in the viewport.

```javascript
// Reasoning card visible in viewport (impression)
dataLayer.push({
  event: "al_tracker_impression",
  al: {
    feature: "daily-planner",
    item: "reasoning-card-shown",
    params: {
      task_position: 1,         // int: position in plan (1-based)
      tier: 1,                  // int: always 1 for impression (Tier 1 visible by default)
    }
  },
  _clear: true
});
```

### Event: reasoning-card-expanded

Fires when user expands a reasoning card to Tier 2 or Tier 3.

```javascript
// Reasoning card expanded to higher tier
dataLayer.push({
  event: "al_tracker_custom",
  al: {
    feature: "daily-planner",
    item: "reasoning-card-expanded",
    action: "expand",
    params: {
      tier: 2,                  // int: 2 | 3 (target tier)
      task_position: 1,         // int: position in plan
      confidence: 87,           // int: AI confidence percentage (Tier 2+)
    }
  },
  _clear: true
});
```

### Event: plan-override

Fires when user overrides an AI recommendation.

```javascript
// User overrides AI recommendation
dataLayer.push({
  event: "al_tracker_custom",
  al: {
    feature: "daily-planner",
    item: "plan-override",
    action: "override",
    params: {
      reason: "too-tired",      // "too-tired" | "not-relevant" | "wrong-priority" | "custom"
      task_position: 1,         // int: position of overridden task
      reprioritize_time_ms: 1500, // int: time for AI to regenerate plan
    }
  },
  _clear: true
});
```

---

## Flow 3: Onboarding

### Event: onboarding-step-shown (Impression)

Fires when each onboarding step becomes visible.

```javascript
// Onboarding step displayed (impression)
dataLayer.push({
  event: "al_tracker_impression",
  al: {
    feature: "onboarding",
    item: "onboarding-step-shown",
    params: {
      step: 1,                  // int: 1-4
      step_name: "task-input",  // "task-input" | "ai-enrichment" | "daily-plan" | "account-prompt"
    }
  },
  _clear: true
});
```

### Event: onboarding-step-completed

Fires when user completes each onboarding step.

```javascript
// Onboarding step completed
dataLayer.push({
  event: "al_tracker_custom",
  al: {
    feature: "onboarding",
    item: "onboarding-step-completed",
    action: "complete",
    params: {
      step: 1,                  // int: 1-4
      step_name: "task-input",  // "task-input" | "ai-enrichment" | "daily-plan" | "account-prompt"
      duration_ms: 12000,       // int: time spent on this step
    }
  },
  _clear: true
});
```

### Event: onboarding-completed

Fires when user finishes the full onboarding flow.

```javascript
// Full onboarding flow completed
dataLayer.push({
  event: "al_tracker_custom",
  al: {
    feature: "onboarding",
    item: "onboarding-completed",
    action: "complete",
    params: {
      total_duration_ms: 45000, // int: total time from Step 1 to finish
      account_created: true,    // bool: did user create account or skip
      method: "google",         // "google" | "skip"
    }
  },
  _clear: true
});
```

### Event: onboarding-skipped-account

Fires specifically when user clicks "Skip for now" on Step 4.

```javascript
// User skipped account creation
dataLayer.push({
  event: "al_tracker_custom",
  al: {
    feature: "onboarding",
    item: "onboarding-skipped-account",
    action: "skip"
  },
  _clear: true
});
```

---

## Flow 4: Core Engagement

### Event: session-started

Fires on each app session start (new visit or return after 30min inactivity).

```javascript
// Session started
dataLayer.push({
  event: "al_tracker_custom",
  al: {
    feature: "engagement",
    item: "session-started",
    action: "start",
    params: {
      is_returning: true,       // bool: user has visited before
      days_since_signup: 3,     // int: days since first visit (for retention cohorts)
      has_account: true,        // bool: authenticated vs guest
      task_count: 12,           // int: total tasks in user's account
    }
  },
  _clear: true
});
```

### Event: time-to-first-task

Fires once when the user creates their very first task. Measures the critical <60s KPI.

```javascript
// Time to first task (fires ONCE per user lifetime)
dataLayer.push({
  event: "al_tracker_custom",
  al: {
    feature: "engagement",
    item: "time-to-first-task",
    action: "milestone",
    params: {
      duration_ms: 28000,       // int: milliseconds from session start to first task save
      method: "text",           // "text" | "voice"
      from_onboarding: true,    // bool: was this during onboarding flow
    }
  },
  _clear: true
});
```

### Event: task-completed

Fires when a user completes (checks off) a task.

```javascript
// Task completed
dataLayer.push({
  event: "al_tracker_custom",
  al: {
    feature: "engagement",
    item: "task-completed",
    action: "complete",
    params: {
      had_ai_priority: true,    // bool: task had AI-generated priority
      priority: "high",         // "high" | "medium" | "low" | "none"
      was_overridden: false,    // bool: user had overridden AI priority
    }
  },
  _clear: true
});
```

### Event: dashboard-loaded (Impression)

Fires when the dashboard page loads with data.

```javascript
// Dashboard loaded with plan data (impression)
dataLayer.push({
  event: "al_tracker_impression",
  al: {
    feature: "engagement",
    item: "dashboard-loaded",
    params: {
      task_count: 5,            // int: tasks shown
      has_daily_plan: true,     // bool: AI plan available
      plan_stale: false,        // bool: plan from previous day
    }
  },
  _clear: true
});
```

---

## Implementation Guide

### Next.js / React Integration

Create a tracking utility module:

```typescript
// lib/tracking.ts

type AlParams = Record<string, string | number | boolean>;

interface AlTrackerEvent {
  feature: string;
  item: string;
  action?: string;
  params?: AlParams;
}

// Click/action event
export function trackAction(event: AlTrackerEvent): void {
  window.dataLayer?.push({
    event: "al_tracker_custom",
    al: {
      feature: event.feature,
      item: event.item,
      action: event.action ?? "click",
      ...(event.params && { params: event.params }),
    },
    _clear: true,
  });
}

// Impression/visibility event
export function trackImpression(event: Omit<AlTrackerEvent, "action">): void {
  window.dataLayer?.push({
    event: "al_tracker_impression",
    al: {
      feature: event.feature,
      item: event.item,
      ...(event.params && { params: event.params }),
    },
    _clear: true,
  });
}
```

### Usage Examples

```typescript
// Task created
trackAction({
  feature: "task-creation",
  item: "task-created",
  action: "save",
  params: { method: "text", is_first_task: true, fields_edited: 1 },
});

// Reasoning card expanded
trackAction({
  feature: "daily-planner",
  item: "reasoning-card-expanded",
  action: "expand",
  params: { tier: 2, task_position: 1, confidence: 87 },
});

// Onboarding step impression
trackImpression({
  feature: "onboarding",
  item: "onboarding-step-shown",
  params: { step: 1, step_name: "task-input" },
});
```

### GTM Container Setup

1. **Tag**: Custom HTML tag firing `al_tracker_custom` → Google Analytics 4 event
2. **Trigger**: Custom Event matching `al_tracker_custom` and `al_tracker_impression`
3. **Variables**: dataLayer variables for `al.feature`, `al.item`, `al.action`, `al.params.*`
4. **GA4 Event Mapping**:
   - Event Name: `{{al.feature}}_{{al.item}}`
   - Parameters: flatten `al.params` to GA4 event parameters

---

## Event Reference Table

| # | Event | Type | Feature | Item | Action | Key Params |
|---|-------|------|---------|------|--------|------------|
| 1 | task-created | click | task-creation | task-created | save | method, is_first_task |
| 2 | ai-parse-completed | click | task-creation | ai-parse-completed | parse | parse_time_ms, fields_extracted |
| 3 | parsed-field-edited | click | task-creation | parsed-field-edited | edit | field_name |
| 4 | voice-capture-started | click | task-creation | voice-capture-started | start | source |
| 5 | voice-capture-completed | click | task-creation | voice-capture-completed | complete | success, duration_ms |
| 6 | daily-plan-generated | click | daily-planner | daily-plan-generated | generate | task_count, trigger |
| 7 | reasoning-card-shown | impression | daily-planner | reasoning-card-shown | — | task_position, tier |
| 8 | reasoning-card-expanded | click | daily-planner | reasoning-card-expanded | expand | tier, confidence |
| 9 | plan-override | click | daily-planner | plan-override | override | reason, task_position |
| 10 | onboarding-step-shown | impression | onboarding | onboarding-step-shown | — | step, step_name |
| 11 | onboarding-step-completed | click | onboarding | onboarding-step-completed | complete | step, duration_ms |
| 12 | onboarding-completed | click | onboarding | onboarding-completed | complete | total_duration_ms, account_created |
| 13 | onboarding-skipped-account | click | onboarding | onboarding-skipped-account | skip | — |
| 14 | session-started | click | engagement | session-started | start | is_returning, days_since_signup |
| 15 | time-to-first-task | click | engagement | time-to-first-task | milestone | duration_ms, method |
| 16 | task-completed | click | engagement | task-completed | complete | priority, was_overridden |
| 17 | dashboard-loaded | impression | engagement | dashboard-loaded | — | task_count, has_daily_plan |

---

## Quality Checklist

- [x] All `event` keys present in dataLayer pushes
- [x] Feature and item are non-empty strings
- [x] Feature/item/action are lowercase-kebab-case
- [x] No abbreviations without clarification
- [x] Names are descriptive and understandable
- [x] `_clear: true` included in all pushes
- [x] No empty `params: {}` (onboarding-skipped-account has no params — omitted correctly)
- [x] Param values use correct ES5 types (strings in quotes, ints/bools without)
- [x] Impressions have no `action` field
- [x] All events map to at least one PRD success metric

---

## Metadata

| Field | Value |
|-------|-------|
| Generated | 2026-02-07 |
| Skill | jaan-to-data-gtm-datalayer |
| Output Path | jaan-to/outputs/data/gtm/01-jaanify-core-tracking/ |
| Status | Draft |
| Version | 3.0 |
| jaan-to Version | v3.16.2 |
