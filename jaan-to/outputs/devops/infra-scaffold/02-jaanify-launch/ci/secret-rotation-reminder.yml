# Jaanify — 90-Day Secret Rotation Reminder
# Opens a GitHub issue every quarter to remind about rotating secrets
# Classifies secrets into "rotate" vs "static" based on env var naming

name: Secret Rotation Reminder

on:
  schedule:
    # Run quarterly: 1st of Jan, Apr, Jul, Oct at 09:00 UTC
    - cron: "0 9 1 1,4,7,10 *"
  workflow_dispatch: # Allow manual trigger

jobs:
  remind:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: Create rotation reminder issue
        uses: actions/github-script@f28e40c7f34bde8b3046d885e986cb6290c5673b # v7
        with:
          script: |
            const today = new Date().toISOString().split('T')[0];
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `90-day secret rotation due — ${today}`,
              body: `## Secret Rotation Checklist\n\nThe following secrets should be reviewed and rotated every 90 days.\n\n### Secrets to Rotate (Credentials)\n\n- [ ] **DATABASE_URL** — Supabase database connection string\n  - Rotate in: [Supabase Dashboard](https://supabase.com/dashboard) > Project Settings > Database > Reset Password\n  - Update: \`gh secret set DATABASE_URL\`\n- [ ] **RAILWAY_TOKEN** — Railway deployment token\n  - Rotate in: [Railway Dashboard](https://railway.app/account/tokens) > Generate new token\n  - Update: \`gh secret set RAILWAY_TOKEN\`\n- [ ] **VERCEL_TOKEN** — Vercel deployment token\n  - Rotate in: [Vercel Dashboard](https://vercel.com/account/tokens) > Create new token\n  - Update: \`gh secret set VERCEL_TOKEN\`\n\n### Static (No Rotation Needed)\n\n- **VERCEL_ORG_ID** — Static org identifier (not a credential)\n- **VERCEL_PROJECT_ID** — Static project identifier (not a credential)\n- **GITHUB_TOKEN** — Auto-rotated by GitHub Actions\n\n### After Rotation\n\n1. Update each secret via \`gh secret set <NAME>\`\n2. Trigger a CD pipeline run to verify: push a commit or re-run the CD workflow\n3. Verify smoke tests pass\n4. Close this issue\n\n---\n> Auto-generated by secret-rotation-reminder workflow`,
              labels: ['security', 'maintenance']
            });
