---
source_tech_md: "jaan-to/context/tech.md"
source_backend_scaffold: "jaan-to/outputs/backend/scaffold/01-jaanify-mvp/"
source_frontend_scaffold: "jaan-to/outputs/frontend/scaffold/01-jaanify-mvp/"
source_detect_dev: "jaan-to/outputs/detect/dev/"
ci_platform: "GitHub Actions"
deploy_target: "Railway (API) + Vercel (Web)"
container_registry: "ghcr.io"
environments: "production"
total_files: 16
status: draft
created: 2026-02-15
last_updated: 2026-02-15
---

# Jaanify Launch — Infrastructure Scaffold

> Generated by jaan.to | 2026-02-15 | Cycle 11 (v6.3.0)

---

## Executive Summary

Complete infrastructure scaffold for Jaanify launch. Regenerated with jaan-to v6.3.0 improvements: health monitoring workflow, secret rotation workflow, pnpm packageManager conflict fix, Next.js standalone config, and CI test script corrections. This scaffold replaces the 01-jaanify-mvp scaffold and addresses gaps L-13, L-14, L-16, L-17.

---

## Overview

| Field | Value |
|-------|-------|
| **CI/CD Platform** | GitHub Actions |
| **Deployment Target** | Railway (API) + Vercel (Web) |
| **Container Registry** | ghcr.io |
| **Environments** | production |
| **Migration Tool** | Prisma v6 (prisma migrate deploy) |
| **Security Scanning** | Trivy + pnpm audit |
| **Total Files** | 16 |
| **Generated** | 2026-02-15 |

## Tech Stack

- **Backend**: Node.js v22 LTS / Fastify v5 (REST + WebSocket)
- **Frontend**: React v19 / Next.js v15 App Router (standalone output)
- **Database**: PostgreSQL 16 (Supabase) + Redis 7 (Upstash)
- **Package Manager**: pnpm v9 + Turborepo monorepo
- **Testing**: Vitest v3 + Playwright v1.50

---

## CI Pipeline (ci.yml)

### Stages

| Stage | Tool | Trigger | Cache |
|-------|------|---------|-------|
| Detect Changes | dorny/paths-filter | All pushes + PRs | — |
| Lint | ESLint | API or Web changes | pnpm store |
| Type Check | tsc --noEmit | API or Web changes | pnpm store |
| Test API | Vitest | API changes | pnpm store + Prisma |
| Test Web | Vitest | Web changes | pnpm store |
| Build | Turborepo | After lint + tests pass | pnpm + .next/cache |
| Security | Trivy + pnpm audit | API or Web changes | — |

### Key Improvements (v6.3.0)

1. **Prisma generate** added to lint job — type checks need generated client
2. **Test scripts fixed** — uses `pnpm --filter jaanify-api test` (matches package.json) instead of `test:unit`/`test:integration`
3. **pnpm version** — reads from `packageManager` field in package.json (no explicit version param)

---

## CD Pipeline (cd.yml)

### Deployment Flow

```
push to main → build Docker image → push to ghcr.io → run migrations → deploy API (Railway) + Web (Vercel) → smoke test
```

---

## Health Monitoring (health-check.yml) — NEW in v6.3.0

| Feature | Implementation |
|---------|---------------|
| Schedule | Every 15 minutes (cron) |
| Endpoints | API (/v1/health) + Web (/) via repository variables |
| On Failure | Create GitHub issue with `incident` label |
| Deduplication | Check for existing open incidents before creating |
| On Recovery | Auto-close incident with resolution comment |

---

## Secret Rotation (secret-rotation-reminder.yml) — NEW in v6.3.0

| Feature | Implementation |
|---------|---------------|
| Schedule | Quarterly (Jan/Apr/Jul/Oct) |
| Rotate | DATABASE_URL, RAILWAY_TOKEN, VERCEL_TOKEN |
| Static | VERCEL_ORG_ID, VERCEL_PROJECT_ID, GITHUB_TOKEN |
| Output | GitHub issue with checklist |

---

## Docker Configuration

### Backend Dockerfile (Dockerfile.api)

| Stage | Base Image | Purpose | Est. Size |
|-------|-----------|---------|-----------|
| deps | node:22-alpine | Install dependencies | ~200MB |
| build | deps | TypeScript compile + Prisma generate | ~300MB |
| runtime | node:22-alpine | Production server | ~180MB |

### Frontend Dockerfile (Dockerfile.web)

| Stage | Base Image | Purpose | Est. Size |
|-------|-----------|---------|-----------|
| deps | node:22-alpine | Install dependencies | ~200MB |
| build | deps | Next.js build (standalone) | ~400MB |
| runtime | node:22-alpine | Standalone server | ~120MB |

### docker-compose Services

| Service | Image | Port | Healthcheck | Profile |
|---------|-------|------|-------------|---------|
| postgres | postgres:16-alpine | 5432 | pg_isready | — |
| redis | redis:7-alpine | 6379 | redis-cli ping | — |
| api | Dockerfile.api | 4000 | wget /v1/health | backend, full |
| web | Dockerfile.web | 3000 | wget / | full |

---

## Generated Files

| # | Path | Type | Description |
|---|------|------|-------------|
| 1 | ci/ci.yml | Workflow | CI: lint, type-check, test, build, security |
| 2 | ci/cd.yml | Workflow | CD: Docker build, migrate, deploy, smoke test |
| 3 | ci/health-check.yml | Workflow | Health monitoring (15-min cron) |
| 4 | ci/secret-rotation-reminder.yml | Workflow | Quarterly rotation reminder |
| 5 | docker/Dockerfile.api | Docker | Multi-stage backend (180MB runtime) |
| 6 | docker/Dockerfile.web | Docker | Multi-stage frontend standalone (120MB runtime) |
| 7 | docker/docker-compose.yml | Docker | Full-stack dev environment |
| 8 | docker/docker-compose.prod.yml | Docker | Production overrides |
| 9 | docker/.dockerignore | Docker | Build context exclusions |
| 10 | config/.env.example | Config | All env vars with safe defaults |
| 11 | config/.env.test | Config | Test environment |
| 12 | config/.env.production.example | Config | Production template (no secrets) |
| 13 | deploy/railway.toml | Deploy | Railway API config |
| 14 | deploy/vercel.json | Deploy | Vercel Web config |
| 15 | deploy/migration.sh | Deploy | Prisma migration script |
| 16 | 02-jaanify-launch-readme.md | Docs | Setup + deployment instructions |

---

## Quality Checks Passed

- [x] CI workflow covers lint, type-check, test, build, security scan stages
- [x] CD workflow deploys to production with migration step
- [x] Dockerfiles use multi-stage builds with non-root runtime users
- [x] docker-compose.yml has healthchecks and `condition: service_healthy`
- [x] .env.example documents all required variables with safe defaults
- [x] .env.production.example contains NO actual secrets
- [x] Health check workflow has deduplication logic
- [x] Secret rotation reminder classifies env vars correctly
- [x] pnpm workflows read version from packageManager field (no explicit version)
- [x] Next.js Dockerfile uses standalone output mode
- [x] All actions pinned by SHA
- [x] No hardcoded secrets in any generated file

---

## Metadata

| Field | Value |
|-------|-------|
| Generated | 2026-02-15 |
| Skill | jaan-to:devops-infra-scaffold |
| jaan-to Version | v6.3.0 (SHA: e544b52) |
| Output Path | jaan-to/outputs/devops/infra-scaffold/02-jaanify-launch/ |
| Previous | jaan-to/outputs/devops/infra-scaffold/01-jaanify-mvp/ |
| Status | Draft |
