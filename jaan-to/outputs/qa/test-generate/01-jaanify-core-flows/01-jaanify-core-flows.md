# Jaanify Core Flows — Test Suite

> Generated by jaan-to:qa-test-generate | 2026-02-11

---

## Executive Summary

Runnable test suite for Jaanify MVP core flows generated from 74 BDD scenarios and backend scaffold + service implementation code. Includes 8 Vitest unit test files (~45 scenarios), 3 integration test files (~20 scenarios), and 7 Playwright E2E specs (74 scenarios). Test infrastructure: 4 data factories, MSW mock handlers (Google OAuth + OpenAI), Vitest workspace config with unit + integration separation, and Playwright BDD config with multi-browser support. Coverage targets: 80% line (unit), 60% line (integration), 100% scenario (E2E).

---

## Metadata

| Field | Value |
|-------|-------|
| Generated | 2026-02-11 |
| Skill | jaan-to:qa-test-generate |
| jaan-to Version | v6.0.0 (SHA: 736820e) |
| Output Path | jaan-to/outputs/qa/test-generate/01-jaanify-core-flows/ |
| Input: qa-test-cases | jaan-to/outputs/qa/cases/01-jaanify-core-flows/ |
| Input: backend-scaffold | jaan-to/outputs/backend/scaffold/01-jaanify-mvp/ |
| Input: backend-service-implement | jaan-to/outputs/backend/service-implement/01-jaanify-mvp/ |
| Input: backend-api-contract | jaan-to/outputs/backend/api-contract/01-jaanify-mvp/api.yaml |

---

## Test Strategy

### Tag Routing

| Tag | Tier | Runner | Target |
|-----|------|--------|--------|
| @smoke (7) | Unit + E2E | Vitest + Playwright | Critical path validation |
| @positive (22) | E2E | Playwright | Full UI flows |
| @negative (30) | Unit + Integration + E2E | All | Error handling at every layer |
| @boundary (9) | Unit | Vitest | Limit validation, scoring edge cases |
| @edge-case (22) | Unit + E2E | Vitest + Playwright | Concurrent ops, state transitions |

### Framework Stack

| Layer | Tool | Version |
|-------|------|---------|
| Unit/Integration | Vitest | v3 |
| E2E | Playwright | v1.50 |
| BDD Binding | jest-cucumber pattern for Vitest; playwright-bdd for E2E |  |
| API Mocking | MSW | v2 |
| Data Factories | Fishery | latest |
| Accessibility | @axe-core/playwright | latest |

---

## Coverage Map

### Unit Tests (8 files, ~45 scenarios)

| File | Source | Scenarios | Maps to BDD |
|------|--------|-----------|-------------|
| auth-tokens.test.ts | lib/auth-tokens.ts | 11 | Token gen/verify, expiry, cross-type |
| error-factory.test.ts | lib/error-factory.ts | 7 | RFC 9457 types, status codes |
| pagination.test.ts | lib/pagination.ts | 5 | Cursor pagination edge cases |
| auth.service.test.ts | routes/auth/auth.service.ts | 8 | F4-S3, F4-S8 (OAuth, refresh, register) |
| tasks.service.test.ts | routes/tasks/tasks.service.ts | 12 | F1-S1, F1-S6, F1-S8, F1-S9 (CRUD, AI parse, priority) |
| daily-plans.service.test.ts | routes/daily-plans/ | 7 | F2-S1, F2-S5, F2-S6, F2-S9 (plan gen, fallback) |
| auth-plugin.test.ts | plugins/auth.ts | 6 | JWT middleware, public paths, errors |
| env.test.ts | lib/env.ts | 4 | Env validation, defaults, min length |

### Integration Tests (3 files, ~20 scenarios)

| File | Endpoints | Scenarios | Maps to BDD |
|------|-----------|-----------|-------------|
| auth.integration.test.ts | POST /auth/google, /auth/refresh, DELETE /auth/logout | 7 | F4-S3, auth error flows |
| tasks.integration.test.ts | GET/POST/PATCH/DELETE /tasks, POST /tasks/parse | 8 | F1-S1, task CRUD integration |
| daily-plans.integration.test.ts | GET /daily-plans, POST /generate, PATCH slots | 5 | F2-S1, plan generation |

### E2E Tests (7 files, 74 scenarios)

| File | Feature | Scenarios | BDD Coverage |
|------|---------|-----------|--------------|
| task-creation.spec.ts | F1: Natural Language Task Creation | 12 | US-01 complete |
| daily-plan.spec.ts | F2: Transparent AI Daily Plan | 12 | US-02 complete |
| voice-capture.spec.ts | F3: Voice Task Capture | 6 | US-03 partial (Web Speech API limitation) |
| onboarding.spec.ts | F4: 60-Second Onboarding | 10 | US-04 complete |
| reasoning-cards.spec.ts | F5: Reasoning Card Drill-Down | 9 | US-05 complete |
| task-prioritization.spec.ts | F6: Task Prioritization | 7 | US-06 complete |
| accessibility.spec.ts | F7: Accessibility | 8 | US-07 complete |

---

## Test Data Strategy

### Factories (Fishery)

| Factory | Variants | Used By |
|---------|----------|---------|
| user.factory.ts | default, deleted, google | auth, integration |
| task.factory.ts | default, withDeadline, highPriority, completed, deleted, aiParsed | tasks, plans |
| daily-plan.factory.ts | default, empty, generating | plans |
| guest-session.factory.ts | default, expired, empty | auth, onboarding |

### MSW Handlers

| Handler | Target | Default Response |
|---------|--------|-----------------|
| Google OAuth | oauth2.googleapis.com/token | Mock id_token with test@example.com |
| OpenAI Chat | api.openai.com/v1/chat/completions | Task parse or plan ordering JSON |
| Error variants | Same endpoints | 503, 400, timeout |

---

## CI Execution Guide

### Package.json Scripts

```json
{
  "scripts": {
    "test": "vitest run",
    "test:unit": "vitest run --workspace=unit",
    "test:integration": "vitest run --workspace=integration",
    "test:e2e": "playwright test",
    "test:e2e:smoke": "playwright test --grep @smoke",
    "test:coverage": "vitest run --coverage"
  }
}
```

### GitHub Actions Integration

```yaml
- name: Unit & Integration Tests
  run: pnpm test:unit && pnpm test:integration

- name: E2E Tests
  run: pnpm test:e2e:smoke  # Smoke subset for CI
```

### Dependencies to Install

```bash
pnpm add -D vitest @vitest/coverage-v8 msw fishery \
  @playwright/test playwright-bdd @axe-core/playwright
```

---

## Known Limitations

1. **Voice capture E2E** — Web Speech API cannot be fully tested in headless browsers. Voice capture tests verify UI states but cannot simulate actual speech recognition.
2. **WebSocket tests** — BDD scenarios F2-S8 (WebSocket disconnection) and F2-S12 (plan refresh) require WebSocket mocking not included in this suite. Recommend `playwright-ws-intercept` or manual mock.
3. **3 unfilled services** — users.service, feedback.service, guest-sessions.service have no unit tests because implementations are TODO stubs.
4. **Performance assertions** — LCP and timing tests (F4-S9, F3-S7) measure wall clock time which varies by CI runner. Thresholds may need adjustment.
