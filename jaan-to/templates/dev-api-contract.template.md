# OpenAPI 3.1 Contract Template

> Generated by jaan.to | {{date}}

---

## OpenAPI YAML Skeleton

Use this as the foundation for generating `api.yaml`. Replace placeholders and expand per resource.

```yaml
openapi: 3.1.0
info:
  title: {{title}} API
  version: {{version}}
  description: {{api_description}}
  contact:
    name: {{contact_name}}
    email: {{contact_email}}
  license:
    name: MIT
    identifier: MIT
  x-generated-by: jaan.to/dev-api-contract

servers:
  - url: https://api.example.com/v1
    description: Production
  - url: https://staging-api.example.com/v1
    description: Staging

tags:
  # One tag per resource
  - name: {{resource_name}}
    description: Operations for {{resource_name}} resources

# ─────────────────────────────────────────────
# COMPONENTS (define before referencing in paths)
# ─────────────────────────────────────────────

components:

  # ── Security Schemes ──────────────────────

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT access token obtained via OAuth2 flow

    # OAuth2 variant (use if OAuth2 selected)
    # OAuth2:
    #   type: oauth2
    #   flows:
    #     authorizationCode:
    #       authorizationUrl: https://auth.example.com/authorize
    #       tokenUrl: https://auth.example.com/token
    #       scopes:
    #         read: Read access
    #         write: Write access

    # API Key variant (use if API Key selected)
    # ApiKeyAuth:
    #   type: apiKey
    #   in: header
    #   name: X-API-Key

  # ── Base Schemas ──────────────────────────

  schemas:

    # Timestamps mixin — use with allOf to add to resources
    Timestamps:
      type: object
      properties:
        created_at:
          type: string
          format: date-time
          description: When the resource was created
          example: "2026-01-15T09:30:00Z"
          readOnly: true
        updated_at:
          type: string
          format: date-time
          description: When the resource was last updated
          example: "2026-02-08T14:22:00Z"
          readOnly: true
      required:
        - created_at
        - updated_at

    # RFC 9457 Problem Details — base error schema
    ProblemDetails:
      type: object
      description: Error response following RFC 9457 Problem Details for HTTP APIs
      properties:
        type:
          type: string
          format: uri
          default: "about:blank"
          description: URI identifying the problem type
          example: "https://api.example.com/errors/not-found"
        status:
          type: integer
          description: HTTP status code
          example: 404
        title:
          type: string
          description: Short human-readable summary (should not change between occurrences)
          example: "Resource Not Found"
        detail:
          type: string
          description: Human-readable explanation specific to this occurrence
          example: "User with ID '550e8400-e29b-41d4-a716-446655440000' was not found"
        instance:
          type: string
          format: uri
          description: URI identifying this specific occurrence
          example: "/errors/requests/abc-123"

    # Validation error extension — extends ProblemDetails with field-level errors
    ValidationProblemDetails:
      allOf:
        - $ref: '#/components/schemas/ProblemDetails'
        - type: object
          properties:
            errors:
              type: array
              description: Field-level validation errors
              items:
                type: object
                properties:
                  detail:
                    type: string
                    description: Validation error message
                    example: "must be a valid email address"
                  pointer:
                    type: string
                    description: JSON Pointer (RFC 6901) to the field
                    example: "/email"
                required:
                  - detail
                  - pointer

    # Cursor-based pagination metadata
    PaginationMeta:
      type: object
      description: Pagination metadata for list endpoints
      properties:
        cursor:
          type:
            - string
            - "null"
          description: Opaque cursor for the next page. Null if no more results.
          example: "eyJpZCI6MTAwfQ=="
        has_more:
          type: boolean
          description: Whether more results exist beyond this page
          example: true
        limit:
          type: integer
          description: Number of items per page
          minimum: 1
          maximum: 100
          example: 20
      required:
        - cursor
        - has_more
        - limit

    # ── Resource Schemas ────────────────────
    # Generate per resource: {Resource}, {Resource}Create, {Resource}Update,
    # {Resource}Response, {Resource}List

    # Example: User resource
    # User:
    #   type: object
    #   description: A user account
    #   properties:
    #     id:
    #       type: string
    #       format: uuid
    #       description: Unique identifier
    #       example: "550e8400-e29b-41d4-a716-446655440000"
    #       readOnly: true
    #     email:
    #       type: string
    #       format: email
    #       description: User's email address
    #       minLength: 5
    #       maxLength: 254
    #       example: "jane@example.com"
    #     name:
    #       type: string
    #       description: User's display name
    #       minLength: 1
    #       maxLength: 100
    #       example: "Jane Doe"
    #   required:
    #     - id
    #     - email
    #     - name
    #
    # UserCreate:
    #   type: object
    #   description: Fields for creating a new user
    #   properties:
    #     email:
    #       type: string
    #       format: email
    #       minLength: 5
    #       maxLength: 254
    #     name:
    #       type: string
    #       minLength: 1
    #       maxLength: 100
    #   required:
    #     - email
    #     - name
    #
    # UserUpdate:
    #   type: object
    #   description: Fields for updating a user (all optional)
    #   properties:
    #     email:
    #       type: string
    #       format: email
    #       minLength: 5
    #       maxLength: 254
    #     name:
    #       type: string
    #       minLength: 1
    #       maxLength: 100
    #
    # UserResponse:
    #   allOf:
    #     - $ref: '#/components/schemas/User'
    #     - $ref: '#/components/schemas/Timestamps'
    #
    # UserList:
    #   type: object
    #   properties:
    #     data:
    #       type: array
    #       items:
    #         $ref: '#/components/schemas/UserResponse'
    #     pagination:
    #       $ref: '#/components/schemas/PaginationMeta'
    #   required:
    #     - data
    #     - pagination

  # ── Shared Parameters ─────────────────────

  parameters:
    CursorParam:
      name: cursor
      in: query
      required: false
      description: Opaque cursor from previous page's pagination.cursor
      schema:
        type: string

    LimitParam:
      name: limit
      in: query
      required: false
      description: Maximum number of items to return
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20

    # PathIdParam:
    #   name: id
    #   in: path
    #   required: true
    #   description: Resource unique identifier
    #   schema:
    #     type: string
    #     format: uuid

  # ── Shared Responses ──────────────────────

  responses:
    BadRequest:
      description: Malformed request
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/ProblemDetails'
          examples:
            malformed-json:
              summary: Invalid JSON in request body
              value:
                type: "about:blank"
                status: 400
                title: "Bad Request"
                detail: "Request body contains malformed JSON"

    Unauthorized:
      description: Missing or invalid authentication
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/ProblemDetails'
          examples:
            missing-token:
              summary: No authentication token provided
              value:
                type: "about:blank"
                status: 401
                title: "Unauthorized"
                detail: "Authentication token is required"

    Forbidden:
      description: Authenticated but insufficient permissions
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/ProblemDetails'
          examples:
            insufficient-scope:
              summary: Token lacks required scope
              value:
                type: "about:blank"
                status: 403
                title: "Forbidden"
                detail: "You do not have permission to perform this action"

    NotFound:
      description: Resource not found
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/ProblemDetails'
          examples:
            resource-not-found:
              summary: Requested resource does not exist
              value:
                type: "https://api.example.com/errors/not-found"
                status: 404
                title: "Resource Not Found"
                detail: "The requested resource was not found"

    Conflict:
      description: Resource state conflict
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/ProblemDetails'
          examples:
            duplicate:
              summary: Resource already exists
              value:
                type: "https://api.example.com/errors/conflict"
                status: 409
                title: "Conflict"
                detail: "A resource with this identifier already exists"

    ValidationError:
      description: Request body validation failed
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/ValidationProblemDetails'
          examples:
            validation-failed:
              summary: Multiple field validation errors
              value:
                type: "https://api.example.com/errors/validation"
                status: 422
                title: "Validation Error"
                detail: "Request body contains invalid fields"
                errors:
                  - detail: "must be a valid email address"
                    pointer: "/email"
                  - detail: "must be between 1 and 100 characters"
                    pointer: "/name"

    TooManyRequests:
      description: Rate limit exceeded
      headers:
        Retry-After:
          description: Seconds until rate limit resets
          schema:
            type: integer
            example: 60
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/ProblemDetails'
          examples:
            rate-limited:
              summary: Too many requests
              value:
                type: "about:blank"
                status: 429
                title: "Too Many Requests"
                detail: "Rate limit exceeded. Retry after 60 seconds."

    InternalError:
      description: Internal server error
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/ProblemDetails'
          examples:
            internal:
              summary: Unexpected server error
              value:
                type: "about:blank"
                status: 500
                title: "Internal Server Error"
                detail: "An unexpected error occurred. Reference: req-abc-123"

  # ── Named Examples ────────────────────────

  # examples:
  #   user-created:
  #     summary: Successful user creation
  #     value:
  #       id: "550e8400-e29b-41d4-a716-446655440000"
  #       email: "jane@example.com"
  #       name: "Jane Doe"
  #       created_at: "2026-02-08T12:00:00Z"
  #       updated_at: "2026-02-08T12:00:00Z"

# ─────────────────────────────────────────────
# PATHS (reference components via $ref)
# ─────────────────────────────────────────────

# paths:
#   /users:
#     get:
#       operationId: listUsers
#       summary: List all users
#       description: Returns a paginated list of users
#       tags: [Users]
#       parameters:
#         - $ref: '#/components/parameters/CursorParam'
#         - $ref: '#/components/parameters/LimitParam'
#       responses:
#         '200':
#           description: Paginated list of users
#           content:
#             application/json:
#               schema:
#                 $ref: '#/components/schemas/UserList'
#         '401':
#           $ref: '#/components/responses/Unauthorized'
#         '403':
#           $ref: '#/components/responses/Forbidden'
#         '429':
#           $ref: '#/components/responses/TooManyRequests'
#         '500':
#           $ref: '#/components/responses/InternalError'
#
#     post:
#       operationId: createUser
#       summary: Create a new user
#       description: Creates a new user account
#       tags: [Users]
#       requestBody:
#         required: true
#         content:
#           application/json:
#             schema:
#               $ref: '#/components/schemas/UserCreate'
#       responses:
#         '201':
#           description: User created successfully
#           headers:
#             Location:
#               description: URL of the created resource
#               schema:
#                 type: string
#                 format: uri
#           content:
#             application/json:
#               schema:
#                 $ref: '#/components/schemas/UserResponse'
#         '400':
#           $ref: '#/components/responses/BadRequest'
#         '401':
#           $ref: '#/components/responses/Unauthorized'
#         '403':
#           $ref: '#/components/responses/Forbidden'
#         '409':
#           $ref: '#/components/responses/Conflict'
#         '422':
#           $ref: '#/components/responses/ValidationError'
#         '429':
#           $ref: '#/components/responses/TooManyRequests'
#         '500':
#           $ref: '#/components/responses/InternalError'

# ─────────────────────────────────────────────
# SECURITY (global)
# ─────────────────────────────────────────────

security:
  - BearerAuth: []
```

---

## Tech Context Integration

When tech.md is available, incorporate these sections:

**Stack**: {{import:$JAAN_CONTEXT_DIR/tech.md#current-stack}}

**Frameworks**: {{import:$JAAN_CONTEXT_DIR/tech.md#frameworks}}

**Constraints**: {{import:$JAAN_CONTEXT_DIR/tech.md#constraints}}

**Versioning**: {{import:$JAAN_CONTEXT_DIR/tech.md#versioning}}

**Patterns**: {{import:$JAAN_CONTEXT_DIR/tech.md#patterns}}

---

## Companion Markdown Template

Use this structure for the `{id}-contract-{slug}.md` companion guide:

```markdown
# {{title}} API — Quick Start Guide

> Generated by jaan.to | {{date}}

---

## Executive Summary

{1-2 sentence description of what this API does and who it serves}

---

## Authentication

{Auth method description, how to obtain tokens, scopes if applicable}

---

## Quick Start

### List resources

\`\`\`bash
curl -H "Authorization: Bearer $TOKEN" \
  https://api.example.com/v1/{resources}
\`\`\`

### Create a resource

\`\`\`bash
curl -X POST \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{{create_example_json}}' \
  https://api.example.com/v1/{resources}
\`\`\`

---

## Pagination

{Explanation of cursor-based pagination, example of paginating through results}

---

## Error Handling

All errors follow [RFC 9457 Problem Details](https://www.rfc-editor.org/rfc/rfc9457):

\`\`\`json
{
  "type": "https://api.example.com/errors/validation",
  "status": 422,
  "title": "Validation Error",
  "detail": "Request body contains invalid fields",
  "errors": [
    { "detail": "must be a valid email", "pointer": "/email" }
  ]
}
\`\`\`

---

## Resources

| Method | Path | Operation ID | Description |
|--------|------|-------------|-------------|
{resource_table_rows}

---

## Validation & Tooling

\`\`\`bash
# Lint the spec
npx @stoplight/spectral-cli lint api.yaml
npx @redocly/cli lint api.yaml

# Mock server
npx @stoplight/prism-cli mock api.yaml

# Generate TypeScript client
npx orval --input api.yaml --output ./src/api/

# Contract tests
schemathesis run --url http://localhost:4010 api.yaml
\`\`\`

---

## Metadata

| Field | Value |
|-------|-------|
| Generated | {{date}} |
| Skill | dev-api-contract |
| OpenAPI | 3.1.0 |
| Status | Draft |
```
