# Jaanify â€” 90-Day Secret Rotation Reminder
# Opens a GitHub issue every 90 days to remind about rotating secrets

name: Secret Rotation Reminder

on:
  schedule:
    # Run every 90 days (1st of Jan, Apr, Jul, Oct at 09:00 UTC)
    - cron: "0 9 1 1,4,7,10 *"
  workflow_dispatch: # Allow manual trigger

jobs:
  remind:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: Create rotation reminder issue
        uses: actions/github-script@f28e40c7f34bde8b3046d885e986cb6290c5673b # v7
        with:
          script: |
            const today = new Date().toISOString().split('T')[0];
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `ðŸ”‘ 90-day secret rotation due â€” ${today}`,
              body: `## Secret Rotation Checklist

            The following secrets should be reviewed and rotated every 90 days.

            ### GitHub Secrets to Rotate

            - [ ] **DATABASE_URL** â€” Supabase database password
              - Rotate in: [Supabase Dashboard](https://supabase.com/dashboard) â†’ Project Settings â†’ Database â†’ Reset Password
              - Update: \`gh secret set DATABASE_URL\`
            - [ ] **RAILWAY_TOKEN** â€” Railway deployment token
              - Rotate in: [Railway Dashboard](https://railway.app/account/tokens) â†’ Generate new token
              - Update: \`gh secret set RAILWAY_TOKEN\`
            - [ ] **VERCEL_TOKEN** â€” Vercel deployment token
              - Rotate in: [Vercel Dashboard](https://vercel.com/account/tokens) â†’ Create new token
              - Update: \`gh secret set VERCEL_TOKEN\`

            ### Secrets That Don't Need Rotation

            - **VERCEL_ORG_ID** â€” Static org identifier (not a credential)
            - **VERCEL_PROJECT_ID** â€” Static project identifier (not a credential)
            - **GITHUB_TOKEN** â€” Auto-rotated by GitHub Actions

            ### After Rotation

            1. Update each secret via \`gh secret set <NAME>\`
            2. Trigger a CD pipeline run to verify: push a commit or re-run the CD workflow
            3. Verify smoke tests pass
            4. Close this issue

            ---
            > Auto-generated by secret-rotation-reminder workflow
            `,
              labels: ['security', 'maintenance']
            });
